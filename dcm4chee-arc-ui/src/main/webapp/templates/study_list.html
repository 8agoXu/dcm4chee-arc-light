<!-- <pre style="position: absolute;width:50%;top:0;z-index: 9999999;">
        filterMode:{{filterMode}}
        orderby:{{orderby}}
<button ng-click="queryMWL(0)">MWL</button>
</pre> -->
<!-- <md-datepicker ng-model="myDate" md-placeholder="Enter date"></md-datepicker> -->
<div class="headerblock">
<div class="row filter">
    <div class="main_filter_block">
    <div class="col-md-3 block-1-1">
        <div class="row">
            <label for="aet" class="col-md-6 text-right control-label">AET:</label>
            <div class=" col-md-6">    
                <select id="aet" ng-model="aet" class="col-md-12" ng-change="studies = {}">
                    <option ng-repeat="ae in aes" title="{{ae.description}}" ng-click="setTrash(ae)">{{ae.title}}</option>
                </select>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <input id="PatientName" type="text" ng-model="filter.PatientName" placeholder="Patient name" title="Patient name" class="col-md-12" />
            </div>
            <div class="col-md-6">
                <label>
                    <input type="checkbox" ng-model="filter.fuzzymatching"> Fuzzy Matching
                </label>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <input id="PatientID" type="text" ng-model="filter.PatientID" placeholder="Patient ID" title="Patient ID" class="col-md-12" />
            </div>
            <div class="col-md-6">
                <input autocomplete="off" id="IssuerOfPatientID" ng-disabled="disabled.IssuerOfPatientID" type="text" ng-model="filter.IssuerOfPatientID" placeholder="Issuer of patient ID" title="Issuer of patient ID" class="col-md-12" ng-click="conditionWarning($event, !filter.PatientID, 'Patient ID is empty, set first the patient ID!')" ng-keypress="conditionWarning($event, !filter.PatientID, 'Patient ID is empty, set first the patient ID!')" />
            </div>
        </div>
    </div>
    <div class="col-md-3 block-1-1">
        <div class="row">
            <div class="col-md-6">
                <input id="AccessionNumber" type="text" ng-model="filter.AccessionNumber" placeholder="Accession number" title="Accession number" class="col-md-12" />
            </div>
            <div class="col-md-6">
                <input id="LocalNamespaceEntityID" type="text" ng-model="filter['IssuerOfAccessionNumberSequence.LocalNamespaceEntityID']" placeholder="Issuer of accession number" title="Issuer of accession number" class="col-md-12"  />
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <input id="ReferringPhysicianName" type="text" ng-model="filter.ReferringPhysicianName" placeholder="Referring physician name" title="Referring physician name" class="col-md-12" />
            </div>
            <div class="col-md-6">
                <input id="Modality" type="text" size="5"  ng-model="filter.ModalitiesInStudy" ng-click="showModalitySelector = !showModalitySelector" placeholder=" Modality"  class="col-md-12" ng-keypress="checkKeyModality($event)"/>
                <div class="modality_selector ng-hide" ng-show="showModalitySelector">
                    <a href="" ng-click="showModalitySelector=false" class="close"><i class="glyphicon glyphicon-remove"></i></a>
                    <div class="common">
                        <a href="" ng-repeat="(key, value) in modalities.common" ng-click="selectModality(key)" title="{{value}}">{{key}}</a>
                    </div>
                    <button ng-click="filter.ModalitiesInStudy='';showModalitySelector=false;" class="clear custom_button">Clear</button>
                    <!-- <div class="col-md-12"></div> -->
                    <a href="" ng-click="showMore=true" ng-show="!showMore" class="more">more<i class="glyphicon glyphicon-triangle-bottom"></i></a>
                    <a href="" ng-click="showMore=false" ng-show="showMore" class="more">less<i class="glyphicon glyphicon-triangle-top"></i></a>
                    <div class="more_block" ng-show="showMore">
                        <a href="" ng-repeat="(key, value) in modalities.more" ng-click="selectModality(key)" title="{{value}}">{{key}}</a>
                        <div class="form-group">
                            <label>Custom modality code:</label>
                            <input ng-model="filter.ModalitiesInStudy" />
                            <button ng-click="showModalitySelector=false" class="custom_button">Add</button>
                        </div>
                    </div>
                </div>
            </div>    
        </div>
        <div class="row">
            <div class="col-md-6">
                <label for="limit" class="block_seid pull-right">Page Size:</label>
            </div>
            <div class="col-md-6">
                <input  id="limit" type="number" min="1" ng-model="limit" class="col-md-12" required/>
            </div>
        </div>
        
    </div>
    <div class="col-md-3 block-1-2" ng-show="filterMode === 'study'">
        <div class="row">
            <label for="StudyDateFrom" class="col-md-12">Study Date:</label>
        </div>
        <div class="row datetime">
            <div class="block_seid">
                <div class="col-md-12">
                    <input 
                        class="col-md-12"
                        placeholder="Study date from" 
                        ng-click="studyDateFromOpen()" 
                        id="StudyDateFrom" 
                        type="text" 
                        uib-datepicker-popup="{{format}}" 
                        ng-model="studyDate.fromObject" 
                        is-open="studyDateFrom.opened" 
                        datepicker-options="dateOptions"
                        close-text="Close"/>
                </div>
                <div class="col-md-12">
                    <input 
                        class="col-md-12"
                        placeholder="Study time from" 
                        id="StudyTimeFrom" 
                        type="text" 
                        size="10"  
                        ng-model="studyTime.fromObject" 
                        data-lng-clockpicker data-lng-clockpicker-options='clockpicker' />
                </div>
            </div>
            <div class="minus text-center">
                -
            </div>
            <div class="block_seid">
                <div class="col-md-12">
                    <input
                        class="col-md-12"
                        placeholder=" Study date to"  
                        class="col-md-12"
                        id="StudyDateTo" 
                        ng-click="studyDateToOpen()"  
                        is-open="studyDateTo.opened" 
                        close-text="Close" 
                        type="text" 
                        size="10" 
                        ng-model="studyDate.toObject" 
                        uib-datepicker-popup="{{format}}"/>
                </div>
                <div class="col-md-12">
                    <input 
                        class="col-md-12"
                        placeholder="Study time to" 
                        id="StudyTimeTo" 
                        type="text" 
                        size="10"  
                        ng-model="studyTime.toObject" 
                        data-lng-clockpicker data-lng-clockpicker-options='clockpicker' />
                </div>
            </div>
        </div>
    </div>
    <a class="clearform_button" title="Clear all filters" href="" ng-click="clearForm()">
        Clear <span class="glyphicon glyphicon-remove"></span>
    </a>
    </div>
    <div class="buttons_block col-md-2">
<!--         <select ng-model="filter.orderby">
            <option value="">Order by ...</option>
            <option value="PatientName">Order by patient name &darr;</option>
            <option value="-PatientName">Order by patient name &uarr;</option>
            <option value="StudyDate,StudyTime">Order by study date &darr;</option>
            <option value="-StudyDate,-StudyTime">Order by study date &uarr;</option>
            <option value="PatientName,StudyDate,StudyTime">Order by patient name &darr; and study date &darr;</option>
            <option value="PatientName,-StudyDate,-StudyTime">Order by patient name &darr; and study date &uarr;</option>
            <option value="-PatientName,StudyDate,StudyTime">Order by patient name &uarr; and study date &darr;</option>
            <option value="-PatientName,-StudyDate,-StudyTime">Order by patient name &uarr; and study date &uarr;</option>
        </select> -->
        <div class="orderbyblock">
            <div class="btn-group" role="group" >
                <button type="button" class="btn btn-default selectedorderbutton" ng-click="showoptionlist = !showoptionlist" ng-init="showoptionlist = false">
                    <span class="selectedorder" ng-init="orderbytext = orderby[2].label" ng-bind-html="orderbytext"></span> 
                    <span class="caret"></span>
                </button>
                <div class="optionlist" ng-show="showoptionlist">
                    <ul>
        <!--                 <li ng-class="{active:filter.orderby === ''}" ng-click="filter.orderby = '';showoptionlist=false;orderbytext = 'Order by ...'">Order by ...</li>
                        <li ng-class="{active:filter.orderby === 'PatientName'}" ng-click="filter.orderby = 'PatientName';showoptionlist=false;orderbytext = 'Patient patient name &darr;'">Patient patient name &darr; <span class="glyphicon glyphicon-sort-by-alphabet"></span> <span class="orderbydateasc"></span></li>
                        <li ng-class="{active:filter.orderby === '-PatientName'}" ng-click="filter.orderby = '-PatientName';showoptionlist=false;orderbytext = 'Patient patient name &uarr;'">Patient patient name &uarr;<span class="glyphicon glyphicon-sort-by-alphabet-alt"></span></li>
                        <li ng-class="{active:filter.orderby === 'StudyDate,StudyTime'}" ng-click="filter.orderby = 'StudyDate,StudyTime';showoptionlist=false;orderbytext = 'Study study date &darr;'">Study study date &darr; <span class="orderbydatedesc"></span></li>
                        <li ng-class="{active:filter.orderby === '-StudyDate,-StudyTime'}" ng-click="filter.orderby = '-StudyDate,-StudyTime';showoptionlist=false;orderbytext = 'Study study date &uarr;'">Study study date &uarr;</li>
                        <li ng-class="{active:filter.orderby === 'PatientName,StudyDate,StudyTime'}" ng-click="filter.orderby = 'PatientName,StudyDate,StudyTime';showoptionlist=false;orderbytext = 'Study patient name &darr; and study date &darr;'">Study patient name &darr; and study date &darr;</li>
                        <li ng-class="{active:filter.orderby === 'PatientName,-StudyDate,-StudyTime'}" ng-click="filter.orderby = 'PatientName,-StudyDate,-StudyTime';showoptionlist=false;orderbytext = 'Study patient name &darr; and study date &uarr;'">Study patient name &darr; and study date &uarr;</li>
                        <li ng-class="{active:filter.orderby === '-PatientName,StudyDate,StudyTime'}" ng-click="filter.orderby = '-PatientName,StudyDate,StudyTime';showoptionlist=false;orderbytext = 'Study patient name &uarr; and study date &darr;'">Study patient name &uarr; and study date &darr;</li>
                        <li ng-class="{active:filter.orderby === '-PatientName,-StudyDate,-StudyTime'}" ng-click="filter.orderby = '-PatientName,-StudyDate,-StudyTime';showoptionlist=false;orderbytext = 'Study patient name &uarr; and study date &uarr;'">Study patient name &uarr; and study date &uarr;</li> -->
                        <li ng-repeat="order in orderby" ng-class="{active:filter.orderby === order.value}" ng-click="$parent.showoptionlist = false; filter.orderby = order.value; $parent.orderbytext = order.label; $parent.filterMode = order.mode;" title="{{filterMode}}" ng-bind-html="order.label"></li>
                    </ul>
                </div>
<!--                 <button class="btn btn-default" type="button">Go!</button>
-->             <button type="button" class="btn btn-default executebutton" ng-hide="
                        filter.orderby === '' ||
                        filter.orderby === 'StudyDate,StudyTime' || 
                        filter.orderby === '-StudyDate,-StudyTime' ||
                        filter.orderby === 'PatientName,StudyDate,StudyTime'||
                        filter.orderby === 'PatientName,-StudyDate,-StudyTime'||
                        filter.orderby === '-PatientName,StudyDate,StudyTime'||
                        filter.orderby === '-PatientName,-StudyDate,-StudyTime'
                    " 
                    id="querypatients" class="btn btn-info" ng-click="queryPatients(0);patientmode=true" title="Query Patients">
                <span class="glyphicon glyphicon-refresh"></span>
                </button>
                <button type="button" class="btn btn-default executebutton" ng-disabled="filter.orderby === ''" class="btn" ng-hide="filter.orderby === 'PatientName' || filter.orderby === '-PatientName'" id="querystudies" class="btn btn-info" ng-click="queryStudies(0);patientmode=false" title="Query Studies">
                <span class="glyphicon glyphicon-refresh"></span>
                </button>
            </div>
        </div>

        <a ng-show="isRole('admin')" ng-click="deleteRejectedInstances()" href="" title="Delete Rejected Instances permanently" class="btn-danger btn">Delete Instances 
            <span class="glyphicon glyphicon-trash"></span> 
        </a>
    </div>
</div>
<div class="placeholder-35" ng-show="filterMode != 'study'"></div>
<a href="" ng-click="advancedConfig=true" ng-show="!advancedConfig && filterMode === 'study'" class="more">Extended filters<i class="glyphicon glyphicon-triangle-bottom"></i></a>
<a href="" ng-click="advancedConfig=false" ng-show="advancedConfig && filterMode === 'study'" class="more ng-hide">Close extended filters<i class="glyphicon glyphicon-triangle-top"></i></a>

<div class="row ng-hide filter hidden_filters" ng-show="advancedConfig">
    <div class="col-md-3 block-2-1"  ng-show="filterMode === 'study'">

<!--         <div class="row">
            <label for="exporter" class="col-md-6 text-right">Export:</label>
            <div class="col-md-6">
                <select id="exporter" ng-model="exporterID" class="col-md-12">
                    <option ng-repeat="exporter in exporters" tooltip="{{exporter.description}}">{{exporter.id}}</option>
                </select>
            </div>
        </div> -->
        <div class="row">
            <div class="col-md-6">
                <input id="StudyID" type="text" ng-model="filter.StudyID" placeholder="Study ID" title="Study ID" class="col-md-12" />
            </div>
            <div class="col-md-6">
                <input id="StudyDescription" type="text" ng-model="filter.StudyDescription" placeholder="Study description" title="Study description" class="col-md-12" />
            </div>
        </div>    
<!--         <div class="row">
            <div class="col-md-6 col-md-offset-6">
                <input id="SeriesDescription" type="text" ng-model="filter.SeriesDescription" placeholder=" Series Description" class="col-md-12" />
            </div>
        </div> -->
<!--         <div class="row">
            <div class="col-md-6 col-md-offset-6">
                <input id="BodyPartExamined" type="text" ng-model="filter.BodyPartExamined" placeholder=" Body Part" class="col-md-12" />
            </div>
        </div> -->

<!--         <div class="row">
            <div class="col-md-6 col-md-offset-6">
                <input id="InstitutionName" type="text" ng-model="filter.InstitutionName" placeholder=" Institution Name" class="col-md-12" />
            </div>
        </div> -->
<!--         <div class="row">
        </div> -->
<!--         <div class="row">
            <div class="col-md-6 col-md-offset-6">
                <input id="SeriesInstanceUID" type="text" ng-model="filter.SeriesInstanceUID" placeholder=" Series Instance UID" class="col-md-12" />
            </div>
        </div> -->
<!--         <div class="row">
            <div class="col-md-6 col-md-offset-6">
                <input id="objectUID" type="text" ng-model="filter.ObjectUID" placeholder=" Object UID" class="col-md-12" />
            </div>
        </div> -->

    </div>
    <div class="col-md-3 block-2-1" ng-show="filterMode === 'study'">
        <!-- <div class="row" ng-show="isRole('admin')"> -->
<!--             <label for="reject" class="block_seid text-right">Reject:</label>
            <div class="block_seid"> -->
<!--                 <select id="reject" ng-model="reject" class="col-md-9">
                    <option ng-repeat="rjn in rjnotes" tooltip="{{rjn.codeMeaning}}"
                            value="{{rjn.codeValue}}^{{rjn.codingSchemeDesignator}}">{{rjn.label}}</option>
                </select> -->
<!--                 <a ng-click="deleteRejectedInstances()" href="" tooltip="Delete Rejected Instances permanently" class="custom_button deleteRejctedI">
                    <span class="glyphicon glyphicon-remove"></span>
                </a> -->
            <!-- </div> -->
        <!-- </div> -->
        <div class="row">
            <div class="col-md-6">
                <input id="SOPClassesInStudy" type="text" ng-model="filter.SOPClassesInStudy" placeholder="SOP classes in study" title="SOP classes in study" class="col-md-12 clearable" />
            </div>
            <div class="col-md-6">
                <input id="StudyInstanceUID" type="text" ng-model="filter.StudyInstanceUID" placeholder="Study instance UID" title="Study instance UID" class="col-md-12 clearable" />
            </div>
        </div>
<!--         <div class="row">
            <label for="limit" class="block_seid text-right">Page Size:</label>
            <div class="block_seid">
                <input class="col-md-12" id="limit" type="number" min="1" ng-model="limit" required/>
            </div>
        </div> -->
<!--         <div class="row">
            <div class="col-md-5 col-md-offset-6">
                <input type="checkbox" ng-model="filter.fuzzymatching"> Fuzzy Matching
            </div>
        </div> -->
    </div>
    <div class="col-md-3 block-2-1" ng-show="filterMode === 'study'">
            <div class="row">
            <div class="col-md-6">
                <label>
                    <input type="checkbox" ng-model="filter.returnempty"> Return empty studies
                </label>
            </div>
            <div class="col-md-6">
                <label>
                    <input type="checkbox" ng-model="filter.expired"> Expired studies
                </label>
            </div>
        </div>
    </div>
</div>
    <div class="header_block" ng-show="patients.length != 0">
        <div class="thead header1" ng-class="{'hover':visibleHeaderIndex === 0}">
            <div class="tr_row">
                <div class="th">  
<!--                     <span ng-show="!allhidden" class="glyphicon glyphicon-triangle-bottom close_allpatients" title="Hide all patients" ng-click="togglePatients('hide')"></span>        
                    <span ng-show="allhidden" class="glyphicon glyphicon-triangle-right open_allpatients" title="Show all patients" ng-click="togglePatients('show')"></span>     -->          
<!--                     <button class="execute btn btn-link btn-xs" ng-click="queryPatients(0);patientmode=true" title="Query Patients">
                        <span class="glyphicon glyphicon-refresh"></span>
                    </button>
                    <button class="execute btn btn-link btn-xs" ng-click="queryStudies(0);patientmode=false" title="Query Studies">
                        <span class="glyphicon glyphicon-refresh"></span>
                    </button>
                    <a ng-show="isRole('admin')" ng-click="deleteRejectedInstances()" href="" title="Delete Rejected Instances permanently" class="deleteRejctedI">
                        <span class="glyphicon glyphicon-trash"></span>
                    </a> -->
    <!--                 <button class="btn btn-link btn-xs"
                            ng-disabled="studies[0].offset==0"
                            ng-click="queryStudies(studies[0].offset-limit)"
                            tooltip="Previous Studies">
                        <span class="glyphicon glyphicon-menu-left"></span>
                    </button>
                    <button class="btn btn-link btn-xs"
                            ng-disabled="!moreStudies"
                            ng-click="queryStudies(studies[0].offset+limit)"
                            tooltip="Next Studies">
                        <span class="glyphicon glyphicon-menu-right"></span>
                    </button>  -->
                </div>
                <div style="width:14%" class="th" >Patient Name
                    <a href="" class="order_arrow" ng-click="filter.orderby = 'PatientName';morePatients !== undefined ? queryPatients(0) : queryStudies(0)">
                        <span class="glyphicon glyphicon-triangle-top" aria-hidden="true"></span>
                    </a>
                    <a href="" class="order_arrow" ng-click="filter.orderby = '-PatientName';morePatients !== undefined ? queryPatients(0) : queryStudies(0)">
                        <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                    </a>
                    </div>
                <div class="th" style="width:12%">
                    Patient ID
                </div>
                <div class="th" style="width:12%">
                    <!-- Referring Physician's Name -->
                    Issuer of patient ID
                </div>
                <div class="th" style="width:8%">
                    Birth Date (YYYYMMDD)
                </div>
                <div class="th" style="width:4%">
                    Sex
                </div>
                <div class="th" style="width:40%">
                    Patient Comments
                </div>
            </div>
        </div>
        <div class="thead header2" ng-class="{'hover':visibleHeaderIndex === 1}">
            <div class="tr_row">
                <div class="th">                

                </div>
                <div class="th">
                        Study ID
                </div>
                <div class="th"  style="width:16.6%">
                        Study Instance UID
                </div>
                <div class="th">Study Date
                    <a href="" class="order_arrow" ng-click="filter.orderby = 'StudyDate,StudyTime';queryStudies(0)">
                        <span class="glyphicon glyphicon-triangle-top" aria-hidden="true"></span>
                    </a>
                    <a href="" class="order_arrow" ng-click="filter.orderby = '-StudyDate,-StudyTime';queryStudies(0)">
                        <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                    </a>
                </div>
                <div style="width:5%" class="th">Study Time</div>
                <div class="th" title="Referring Physician's Name">R. Physician's Name</div>
                <div class="th">Accession Number</div>
                <div style="width:5%" class="th">Modalities</div>
                <div style="width:17.3%" class="th">Study Description</div>
                <div style="width:3%" class="th">#S</div>
                <div style="width:3%" class="th">#I</div>
            </div>
        </div>

        <div class="thead header3" ng-class="{'hover':visibleHeaderIndex === 2}">
            
            <div class="tr_row">
                 <div class="th">
    <!--                <button class="btn btn-link btn-xs"
                            ng-disabled="study.series[0].offset==0"
                            ng-click="querySeries(study, study.series[0].offset-limit)"
                            title="Previous Series">
                        <span class="glyphicon glyphicon-menu-left"></span>
                    </button>
                    <button class="btn btn-link btn-xs"
                            ng-disabled="!study.moreSeries"
                            ng-click="querySeries(study, study.series[0].offset+limit)"
                            title="Next Series">
                        <span class="glyphicon glyphicon-menu-right"></span>
                    </button> -->
                </div>
                <div class="th">Station Name</div>
                <div class="th">Series Number</div>
                <div class="th">PPS Start Date</div>
                <div class="th">PPS Start Time</div>
                <div class="th">Body Part</div>
                <div class="th">Modality</div>
                <div style="width:21%" class="th">Series Description</div>
                <div style="width:2%" class="th">#I</div>
            </div>
        </div>
        <div class="thead header4" ng-class="{'hover':visibleHeaderIndex === 3}">
            <div class="tr_row ">
                <div class="th">
    <!--                 <button class="btn btn-link btn-xs"
                    ng-disabled="series.instances[0].offset==0"
                    ng-click="queryInstances(series, series.instances[0].offset-limit)"
                    title="Previous Instances">
                    <span class="glyphicon glyphicon-menu-left"></span>
                    </button>
                    <button class="btn btn-link btn-xs"
                            ng-disabled="!series.moreInstances"
                            ng-click="queryInstances(series, series.instances[0].offset+limit)"
                            title="Next Instances">
                        <span class="glyphicon glyphicon-menu-right"></span>
                    </button> -->
                </div>
                <div class="th">SOP Class UID</div>
                <div class="th">Instance Number</div>
                <div class="th">Content Date</div>
                <div class="th">Content Time</div>
                <div style="width:28%" class="th">Content Description</div>
                <div style="width:2%" class="th">#F</div>
            </div>
        </div>
    </div>
</div>

<!-- Table -->
<div class="div-table animated" ng-class="{extended:(advancedConfig && filterMode === 'study')}">

    <div class="repeat0" ng-repeat="(patientkey, patient) in patients" ng-init="patient.hide=false">
<!--         <span ng-show="!patient.hide" class="glyphicon glyphicon-triangle-bottom close_patient" title="Hide this patient" ng-click="patient.hide=true"></span>        
        <span ng-show="patient.hide" class="glyphicon glyphicon-triangle-right open_patient" title="Show {{patient.attrs['00100010'].Value[0].Alphabetic}}" ng-click="patient.hide=false"></span> -->
        <div class="thead" ng-class="{hide:patient.hide}">
            <div class="tr_row">
                <div class="th" style="width:10%">   
                    <div ng-show="patientmode" class="table_btn" ng-bind="patient.offset+1+'.'"> </div>          
                    <a class="table_btn" ng-click="patient.showAttributes = !patient.showAttributes" href="" title="Show Attributes">
                        <span class="glyphicon glyphicon-th-list"></span>
                    </a>               
                    <a class="table_btn" ng-click="editPatient(patients[patientkey], patientkey)" href="" title="Edit Patient">
                        <span class="glyphicon glyphicon-pencil"></span>
                    </a>               
                    <a class="table_btn" ng-click="createStudy(patient)" href="" title="Create study">
                        <span class="glyphicon glyphicon-plus"></span>
                    </a>
                    <a class="table_btn" ng-hide="patient.studies" ng-click="queryAllStudiesOfPatient(patient,0)" href="" title="Show Studies">&#9658;</a>
                    <a class="table_btn" ng-show="patient.studies" ng-click="patient.studies = null" href="" title="Hide Studies">&#9660;</a>
                </div>
                <div  style="width:14%" class="th txt hover_cell" tooltip="{{patient.attrs['00100010'].Value[0].Alphabetic}}">{{(patient.attrs['00100010'].Value[0].Alphabetic) || '&nbsp;'}}</div>
                <div style="width:12%" class="th txt hover_cell" tooltip="{{patient.attrs['00100020'].Value[0]}}">{{(patient.attrs['00100020'].Value[0]) || '&nbsp;'}}</div>                
                <div style="width:12%" class="th txt hover_cell" tooltip="{{patient.attrs['00100021'].Value[0]}}">{{(patient.attrs['00100021'].Value[0]) || '&nbsp;'}}</div>
                <div style="width:8%" class="th hover_cell" ng-bind="(patient.attrs['00100030'].Value[0] ) || '&nbsp;'"></div>                
                <div style="width:4%" class="th hover_cell" ng-bind="(patient.attrs['00100040'].Value[0]) || '&nbsp;'">&nbsp;</div>              
                <div style="width:40%" class="th txt hover_cell" tooltip="{{patient.attrs['00104000'].Value[0]}}">{{(patient.attrs['00104000'].Value[0]) || '&nbsp;'}}</div>           
            </div>
        </div>
        <div class="tr_row"  ng-show="patient.showAttributes">
            <div class="td_cell attribute_list" id="{{patient.attrs['00100020'].Value[0]}}">
                <attribute-list ng-if="patient.attrs" attrs="patient.attrs"></attribute-list>
            </div>
        </div>
        <div class="repeat1" ng-repeat="(studykey, study) in patient.studies">
<!--             <div class="thead">
                <div class="tr_row">
                    <div class="th">     
         
                    </div>
                    <div class="th">
                            Study ID
                    </div>
                    <div class="th"  style="width:16.6%">
                            Study Instance UID
                    </div>
                    <div class="th">Study Date
                        <a href="" class="order_arrow" ng-click="filter.orderby = 'StudyDate,StudyTime';queryStudies(0)">
                            <span class="glyphicon glyphicon-triangle-top" aria-hidden="true"></span>
                        </a>
                        <a href="" class="order_arrow" ng-click="filter.orderby = '-StudyDate,-StudyTime';queryStudies(0)">
                            <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                        </a>
                    </div>
                    <div style="width:5%" class="th">Study Time</div>
                    <div class="th" title="Referring Physician's Name">R. Physician's Name</div>  
                    <div class="th">Accession Number</div>
                    <div style="width:5%" class="th">Modalities</div>
                    <div style="width:17.3%" class="th">Study Description</div>
                    <div style="width:3%" class="th">#S</div>
                    <div style="width:3%" class="th">#I</div>
                </div>
            </div> -->
            <div class="tbody">
                <div class="tr_row">
                    <div class="colcell" ng-bind="study.offset+1+'.'"> </div>
                    <div class="subblock">
                        <div class="td_row thead repeat1_hover">
                            <div class="td_cell table_btn">
                                <a ng-click="study.showAttributes = !study.showAttributes" href="" title="Show Attributes">
                                    <span class="glyphicon glyphicon-th-list"></span>
                                </a>
                                <a ng-click="editStudy(patients[patientkey], patientkey, studykey, study)" href="" title="Edit Study">
                                    <span class="glyphicon glyphicon-pencil"></span>
                                </a>
                                <a ng-click="exportStudy(study)" ng-show="exporterID && isRole('admin')" href="" title="Export Study">
                                    <span class="glyphicon glyphicon-export"></span>
                                </a>
                                <a ng-hide="trashaktive || !isRole('admin') || study.attrs['00201208'].Value[0] === 0" ng-click="rejectStudy(study)" href="" title="Reject Study">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </a>
                                <a ng-show="trashaktive && isRole('admin')" ng-click="rejectStudy(study)" href="" title="Restore Study">
                                    <span class="glyphicon glyphicon-repeat"></span>
                                </a>
                                <!--
                                <a ng-href="{{study.attrs['00081190'].Value[0]}}" tooltip="Download Study">
                                    <span class="glyphicon glyphicon-save"></span>
                                </a>
                                -->
                                <a ng-hide="study.series" ng-click="querySeries(study,0)" href="" title="Show Series">&#9658;</a>
                                <a ng-show="study.series" ng-click="study.series = null" href="" title="Hide Series">&#9660;</a>
                            </div>
                            <div style="width:10.4%" class="td_cell txt hover_cell" tooltip="{{study.attrs['00200010'].Value[0]}}">{{(study.attrs['00200010'].Value[0]) || '&nbsp;'}}</div>
                            <div  style="width:17.3%" tooltip="{{study.attrs['0020000D'].Value[0]}}" test="{{study.attrs['0020000D'].Value[0]}}" class="td_cell txt hover_cell" tooltip="{{study.attrs['0020000D'].Value[0]}}">{{(study.attrs['0020000D'].Value[0]) || '&nbsp;'}}</div>
                            <div class="td_cell txt hover_cell" tooltip="{{study.attrs['00080020'].Value[0]}}" >
                                {{(study.attrs['00080020'].Value[0] | formatDA) || '&nbsp;'}}
                                <a ng-show="study.attrs['00080020'].Value[0]" href="" class="order_arrow" ng-click="filter.orderby = 'StudyDate,StudyTime';queryStudies(0)" title="Order Study by Date (descending)">
                                    <span class="glyphicon glyphicon-triangle-top" aria-hidden="true" ></span>
                                </a>
                                <a ng-show="study.attrs['00080020'].Value[0]" href="" class="order_arrow" ng-click="filter.orderby = '-StudyDate,-StudyTime';queryStudies(0)" title="Order Study by Date (ascending)">
                                    <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                                </a>
                            </div>
                            <div style="width:5.1%" class="td_cell hover_cell" ng-bind="(study.attrs['00080030'].Value[0] | formatTM) || '&nbsp;'">&nbsp;</div>
                            <div style="width:10.2%" class="td_cell txt hover_cell"  tooltip="{{study.attrs['00080090'].Value[0].Alphabetic}}">{{(study.attrs['00080090'].Value[0].Alphabetic) || '&nbsp;'}}</div>
                            <div class="td_cell txt hover_cell" tooltip="{{study.attrs['00080050'].Value[0]}}" >{{(study.attrs['00080050'].Value[0]) || '&nbsp;'}}</div>
                            <div style="width:5.2%" class="td_cell hover_cell" ng-bind="(study.attrs['00080061'].Value) || '&nbsp;'">&nbsp;</div>
                            <div style="width:18%" class="td_cell txt hover_cell" tooltip="{{study.attrs['00081030'].Value[0]}}">{{(study.attrs['00081030'].Value[0]) || '&nbsp;'}}</div>
                            <div style="width:3%" class="td_cell txt hover_cell" tooltip="{{study.attrs['00201206'].Value[0]}}" >{{(study.attrs['00201206'].Value[0]) || '&nbsp;'}}</div>
                            <div style="width:3%" class="td_cell txt hover_cell" tooltip="{{study.attrs['00201208'].Value[0]}}">{{(study.attrs['00201208'].Value[0]) || '&nbsp;'}}</div>
                        </div>
                        <div class="td_row">
                            <div class="tr_row"  ng-show="study.showAttributes">
                                <div class="td_cell attribute_list" id="{{patient.attrs['00100020'].Value[0] | removedots}}{{study.attrs['0020000D'].Value[0] | removedots}}"> 
                                    <attribute-list attrs="study.attrs"></attribute-list>
                                </div>
                            </div>
<!--                             <div class="tr_row thead2"  ng-show="study.series && study.series.length">
                                <div class="th">

                                </div>
                                <div class="th">Station Name</div>
                                <div class="th">Series Number</div>
                                <div class="th">PPS Start Date</div>
                                <div class="th">PPS Start Time</div>
                                <div class="th">Body Part</div>
                                <div class="th">Modality</div>
                                <div style="width:21%" class="th">Series Description</div>
                                <div style="width:2%" class="th">#I</div>
                            </div> -->
                            <div class="repeat2" ng-repeat="(serieskey,series) in study.series">
                                    <div class="td_cell colcell" ng-bind="series.offset+1+'.'"> </div>
                            <div class="subblock">
                                <div class="tr_row repeat2_hover">
                                    <div class="td_cell table_btn">
                                        <a ng-click="series.showAttributes = !series.showAttributes" href="" title="Show Attributes">
                                            <span class="glyphicon glyphicon-th-list"></span>
                                        </a>
                                        <a ng-click="exportSeries(series)" ng-show="exporterID && isRole('admin')" href="" title="Export Series">
                                            <span class="glyphicon glyphicon-export"></span>
                                        </a>
                                        <a ng-hide="trashaktive || !isRole('admin') ||  series.attrs['00201209'].Value[0] === 0" ng-click="rejectSeries(series)" href="" title="Reject Series">
                                            <span  class="glyphicon glyphicon-trash"></span>
                                        </a>
                                        <a ng-show="trashaktive && isRole('admin')" ng-click="rejectSeries(series)" href="" title="Restore Series">
                                            <span class="glyphicon glyphicon-repeat"></span>
                                        </a>
                                        <!--
                                        <a ng-href="{{series.attrs['00081190'].Value[0]}}" tooltip="Download Series">
                                            <span class="glyphicon glyphicon-save"></span>
                                        </a>
                                        -->
                                        <a ng-hide="series.instances" ng-click="queryInstances(series,0)" href="" title="Show Instances">&#9658;</a>
                                        <a ng-show="series.instances" ng-click="series.instances = null" href="" title="Hide Instances">&#9660;</a>
                                    </div>
                                    <div class="td_cell txt hover_cell" tooltip="{{series.attrs['00081010'].Value[0]}}" >{{(series.attrs['00081010'].Value[0]) || '&nbsp;'}}</div>
                                    <div class="td_cell txt hover_cell" tooltip="{{series.attrs['00200011'].Value[0]}}" >{{(series.attrs['00200011'].Value[0]) || '&nbsp;'}}</div>
                                    <div class="td_cell txt hover_cell" tooltip="{{series.attrs['00400244'].Value[0]}}" >{{(series.attrs['00400244'].Value[0] | formatDA) || '&nbsp;'}}</div>
                                    <div class="td_cell txt hover_cell" tooltip="{{series.attrs['00400245'].Value[0]}}" >{{(series.attrs['00400245'].Value[0] | formatTM) || '&nbsp;'}}</div>
                                    <div class="td_cell txt hover_cell" tooltip="{{series.attrs['00180015'].Value[0]}}" >{{(series.attrs['00180015'].Value[0]) || '&nbsp;'}}</div>
                                    <div class="td_cell hover_cell" ng-bind="(series.attrs['00080060'].Value[0]) || '&nbsp;'" >&nbsp;</div>
                                    <div style="width:21.5%" class="td_cell txt hover_cell" tooltip="{{(series.attrs['0008103E'].Value[0]) || '&nbsp;'}}">{{(series.attrs['0008103E'].Value[0]) || '&nbsp;'}}</div>
                                    <div style="width:2%" class="td_cell txt hover_cell" tooltip="{{series.attrs['00201209'].Value[0]}}">{{(series.attrs['00201209'].Value[0]) || '&nbsp;'}}</div>
                                </div>
                                <div class="tr_row"  ng-show="series.showAttributes">
                                    <div class="td_cell attribute_list">
                                        <attribute-list attrs="series.attrs"></attribute-list>
                                    </div>
                                </div>
<!--                                 <div class="tr_row thead3"  ng-show="series.instances && series.instances.length">
                                    <div class="th">
                                        <button class="btn btn-link btn-xs"
                                        ng-disabled="series.instances[0].offset==0"
                                        ng-click="queryInstances(series, series.instances[0].offset-limit)"
                                        tooltip="Previous Instances">
                                        <span class="glyphicon glyphicon-menu-left"></span>
                                        </button>
                                        <button class="btn btn-link btn-xs"
                                                ng-disabled="!series.moreInstances"
                                                ng-click="queryInstances(series, series.instances[0].offset+limit)"
                                                tooltip="Next Instances">
                                            <span class="glyphicon glyphicon-menu-right"></span>
                                        </button>
                                    </div>
                                    <div class="th">SOP Class UID</div>
                                    <div class="th">Instance Number</div>
                                    <div class="th">Content Date</div>
                                    <div class="th">Content Time</div>
                                    <div style="width:28%" class="th">Content Description</div>
                                    <div style="width:2%" class="th">#F</div>
                                </div> -->
                                <div class="repeat3"  ng-repeat="(key,instance) in series.instances">
                                    <div class="td_cell colcell" ng-bind="instance.offset+1+'.'"> </div>
                                    <div class="subblock">
                                        <div class="tr_row repeat3_hover">
                                            <div class="td_cell table_btn">   
                                                <a ng-click="toggleAttributs(series.instances[key],'attributs')" href="" title="Show Attributes" ng-class="{active:instance.showAttributes}">
                                                    <span class="glyphicon glyphicon-th-list"></span>
                                                </a>   
                                                <a ng-click="toggleAttributs(series.instances[key],'fileattributs');addFileAttribute(instance)" href="" title="Show Attributes from file" ng-class="{active:instance.showFileAttributes}">
                                                    <span class="glyphicon glyphicon-list"></span>
                                                </a>
                                                <a ng-click="exportInstance(instance)" ng-show="exporterID && isRole('admin')" href="" title="Export Instance">
                                                    <span class="glyphicon glyphicon-export"></span>
                                                </a>
                                                <a ng-hide="trashaktive || !isRole('admin')" ng-click="rejectInstance(instance)" href="" title="Reject Instance">
                                                    <span  class="glyphicon glyphicon-trash"></span>
                                                </a>
                                                <a ng-show="trashaktive && isRole('admin')" ng-click="rejectInstance(instance)" href="" title="Restore Instance">
                                                    <span class="glyphicon glyphicon-repeat"></span>
                                                </a>
                                                <a ng-href="{{downloadURL(instance)}}" title="Download Uncompressed DICOM Object">
                                                    <span class="glyphicon glyphicon-save"></span>
                                                </a>
                                                <a ng-href="{{downloadURL(instance, '*')}}" title="Download DICOM Object">
                                                    <span class="glyphicon glyphicon-download-alt"></span>
                                                </a>
                                                <a ng-hide="instance.views.length > 1" ng-click="viewInstance(instance)" href="" title="View DICOM Object">
                                                    <span class="glyphicon glyphicon-picture"></span>
                                                </a>
                                                <span ng-init="select_show=false" class="selecta" ng-show="instance.views.length > 1" href="" title="View DICOM Object">
                                                    <span class="glyphicon glyphicon-picture" ng-click="select_show = !select_show"></span>
                                                    <div ng-show="select_show" class="select_block" ng-click="select_show = false">
                                                        <a ng-model="instance.view" ng-repeat="(key, value) in instance.views" ng-click="(instance.view=value);viewInstance(instance)">{{value}}</a>
                                                    </div>
    <!--                                                 <select ng-show="instance.views.length > 1"
                                                            ng-options="view for view in instance.views"
                                                            ng-model="instance.view">
                                                    </select> -->
                                                </span>
                                            </div>
                                            <div class="td_cell txt hover_cell"  tooltip="{{instance.attrs['00080016'].Value[0]}}" >{{(instance.attrs['00080016'].Value[0]) || '&nbsp;'}}</div>
                                            <div class="td_cell txt hover_cell"  tooltip="{{instance.attrs['00200013'].Value[0]}}" >{{(instance.attrs['00200013'].Value[0]) || '&nbsp;'}}</div>
                                            <div class="td_cell hover_cell" >{{((instance.attrs['00080023'] || instance.attrs['00700082']).Value[0] | formatDA) || '&nbsp;'}}</div>
                                            <div class="td_cell hover_cell" >{{((instance.attrs['00080033'] || instance.attrs['00700083']).Value[0] | formatTM) || '&nbsp;'}}</div>
                                            <div style="width:28%" class="td_cell txt hover_cell" tooltip="{{(instance.attrs | contentDescription)}}">{{(instance.attrs | contentDescription) || '&nbsp;'}}</div>
                                            <div style="width:2%" class="td_cell hover_cell" >{{(instance.attrs['00280008'].Value[0]) || '&nbsp;'}}</div>
                                        </div>
                                        <div class="tr_row"  ng-show="instance.showAttributes">
                                            <div class="td_cell attribute_list">
                                                <attribute-list attrs="instance.attrs"></attribute-list>
                                            </div>
                                        </div>
                                        <div class="tr_row"  ng-show="instance.showFileAttributes">
                                            <div class="td_cell attribute_list file-attribute-list" id="file-attribute-list-{{instance.attrs['00080018'].Value[0] | removedots}}">
                                                <!-- <file-attribute-list attrs="instance.attrs" instance="instance" aet="aet"></file-attribute-list> -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                <div class="arrows" ng-show="series.instances && series.instances.length">
                                    <div class="arrows_block">
                                        <button class="btn btn-link btn-xs"
                                        ng-disabled="series.instances[0].offset==0"
                                        ng-click="queryInstances(series, series.instances[0].offset-limit)"
                                        title="Previous Instances">
                                        <span class="glyphicon glyphicon-menu-left"></span>
                                        </button>
                                        <button class="btn btn-link btn-xs"
                                                ng-disabled="!series.moreInstances"
                                                ng-click="queryInstances(series, series.instances[0].offset+limit)"
                                                title="Next Instances">
                                            <span class="glyphicon glyphicon-menu-right"></span>
                                        </button>
                                    </div>
                                </div>
                        </div><!--  -->
                    </div>
                        <div class="arrows" ng-show="study.series && study.series.length">
                            <div class="arrows_block">
                                <button class="btn btn-link btn-xs"
                                        ng-disabled="study.series[0].offset==0"
                                        ng-click="querySeries(study, study.series[0].offset-limit)"
                                        title="Previous Series">
                                    <span class="glyphicon glyphicon-menu-left"></span>
                                </button>
                                <button class="btn btn-link btn-xs"
                                        ng-disabled="!study.moreSeries"
                                        ng-click="querySeries(study, study.series[0].offset+limit)"
                                        title="Next Series">
                                    <span class="glyphicon glyphicon-menu-right"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="arrows" ng-show="patient.studies[0].fromAllStudies">
            <div class="arrows_block">
                <button class="btn btn-link btn-xs"
                        ng-disabled="patient.studies[0].offset===0"
                        ng-click="queryAllStudiesOfPatient(patient, patient[0].offset-limit)"
                        title="Previous Study">
                    <span class="glyphicon glyphicon-menu-left"></span>
                </button>
                <button class="btn btn-link btn-xs"
                        ng-disabled="!patient.moreStudies"
                        ng-click="queryAllStudiesOfPatient(patient, patient[0].offset+limit)"
                        title="Next Study">
                    <span class="glyphicon glyphicon-menu-right"></span>
                </button>
            </div>  
        </div>  
    </div>
</div>
<div class="arrows">
    <div class="arrows_block" ng-show="morePatients !== undefined" >
                <button class="btn btn-link btn-xs"
                        ng-disabled="patients[0].offset === 0"
                        ng-click="queryPatients(patients[0].offset-limit);addEffect('left')"
                        title="Previous Patients">
                    <span class="glyphicon glyphicon glyphicon-chevron-left"></span>
                </button>
                <button class="btn btn-link btn-xs"
                        ng-disabled="!morePatients"
                        ng-click="queryPatients(patients[0].offset+limit);addEffect('right')"
                        title="Next Patients">
                    <span class="glyphicon glyphicon glyphicon-chevron-right"></span>
                </button> 
    </div>
    <div class="arrows_block" ng-show="moreStudies !== undefined" >
                <button class="btn btn-link btn-xs"
                        ng-disabled="patients[0].studies[0].offset === 0"
                        ng-click="queryStudies(patients[0].studies[0].offset-limit);addEffect('left')"
                        title="Previous Studies">
                    <span class="glyphicon glyphicon glyphicon-chevron-left"></span>
                </button>
                <button class="btn btn-link btn-xs"
                        ng-disabled="!moreStudies"
                        ng-click="queryStudies(patients[0].studies[0].offset+limit);addEffect('right')"
                        title="Next Studies">
                    <span class="glyphicon glyphicon glyphicon-chevron-right"></span>
                </button> 
    </div>
</div>